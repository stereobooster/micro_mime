# MicroMime

This is the fork of [MiniMime](https://github.com/discourse/mini_mime) with C extension ported from [mime-types-mini](https://github.com/ioquatix/mime-types-mini/).

Minimal mime type implementation for use with the mail and rest-client gem.

## Installation

Add this line to your application's Gemfile:

```ruby
gem 'micro_mime'
```

And then execute:

    $ bundle

Or install it yourself as:

    $ gem install micro_mime

## Usage

```
require 'micro_mime'

MicroMime.lookup_by_filename("a.txt").content_type
# => "text/plain"

MicroMime.lookup_by_content_type("text/plain").extension
# => "txt"

MicroMime.lookup_by_content_type("text/plain").binary?
# => false
```

## Performance

MicroMime is optimised to minimize memory usage. It uses C extension and ideal hash function generated by gperf. There are benchmarks in the [bench directory](https://github.com/stereobooster/micro_mime/bench/bench.rb)

```
Memory stats for requiring mime/types/columnar
Total allocated: 10706215 bytes (114133 objects)
Total retained:  3472281 bytes (31906 objects)

Memory stats for requiring mini_mime
Total allocated: 828369 bytes (8492 objects)
Total retained:  59787 bytes (664 objects)

Memory stats for requiring micro_mime
Total allocated: 36041 bytes (197 objects)
Total retained:  6189 bytes (13 objects)
Warming up --------------------------------------
content_type lookup MicroMime
                        42.838k i/100ms
cached content_type lookup MiniMime
                        33.668k i/100ms
content_type lookup Mime::Types
                        23.091k i/100ms
Calculating -------------------------------------
content_type lookup MicroMime
                        533.235k (± 4.4%) i/s -      2.699M in   5.070920s
cached content_type lookup MiniMime
                        411.676k (± 4.8%) i/s -      2.087M in   5.082885s
content_type lookup Mime::Types
                        252.559k (± 3.6%) i/s -      1.270M in   5.035144s
Warming up --------------------------------------
content_type lookup MicroMime
                        42.817k i/100ms
uncached content_type lookup MiniMime
                         1.794k i/100ms
content_type lookup Mime::Types
                        23.087k i/100ms
Calculating -------------------------------------
content_type lookup MicroMime
                        491.401k (±10.2%) i/s -      2.441M in   5.026893s
uncached content_type lookup MiniMime
                         18.687k (± 4.4%) i/s -     93.288k in   5.002217s
content_type lookup Mime::Types
                        250.703k (± 4.0%) i/s -      1.270M in   5.073133s
```

As a general guideline, cached lookups are 2x faster than MIME::Types equivelent. Uncached lookups are 10x slower.


## Development

MicroMime uses the officially maintained list of mime types at [mime-types-data](https://github.com/mime-types/mime-types-data)repo to build the internal database.

To update the database run:

```ruby
bundle exec rake rebuild_db
```

After checking out the repo, run `bin/setup` to install dependencies. Then, run `rake test` to run the tests. You can also run `bin/console` for an interactive prompt that will allow you to experiment.

To install this gem onto your local machine, run `bundle exec rake install`. To release a new version, update the version number in `version.rb`, and then run `bundle exec rake release`, which will create a git tag for the version, push git commits and tags, and push the `.gem` file to [rubygems.org](https://rubygems.org).

## Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/discourse/mini_mime. This project is intended to be a safe, welcoming space for collaboration, and contributors are expected to adhere to the [Contributor Covenant](http://contributor-covenant.org) code of conduct.


## License

The gem is available as open source under the terms of the [MIT License](http://opensource.org/licenses/MIT).

